From 2d18e383c3fca0ceca441ce8aabae337931d446b Mon Sep 17 00:00:00 2001
From: drh <drh@noemail.net>
Date: Thu, 14 May 2020 23:59:24 +0000
Subject: [PATCH 6/8] Fix a null pointer deference that can occur on a strange
 matchinfo() query.

Upstream Status: Backport https://sqlite.org/src/info/a4dd148928ea65bd
CVE: CVE-2020-13632

FossilOrigin-Name: a4dd148928ea65bd4e1654dfacc3d8057d1f85b8c9939416991d50722e5a720e
Signed-off-by: Anand Je Sypureddy <anandje@mvista.com>
---
 sqlite3.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/sqlite3.c b/sqlite3.c
index 63cc4f0..c8f1624 100644
--- a/sqlite3.c
+++ b/sqlite3.c
@@ -181835,7 +181835,7 @@ static int fts3ExprLHits(
     iStart = pExpr->iPhrase * ((p->nCol + 31) / 32);
   }
 
-  while( 1 ){
+  if( pIter ) while( 1 ){
     int nHit = fts3ColumnlistCount(&pIter);
     if( (pPhrase->iColumn>=pTab->nColumn || pPhrase->iColumn==iCol) ){
       if( p->flag==FTS3_MATCHINFO_LHITS ){
-- 
2.27.0

