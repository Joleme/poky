From 0e1bda51ee98cfc59ec0b892c19c26301a53ff68 Mon Sep 17 00:00:00 2001
From: Sakib Sajal <sakib.sajal@windriver.com>
Date: Thu, 30 Apr 2020 10:46:16 -0700
Subject: [PATCH 1/2] In the event of a semantic error in an aggregate query,
 early-out the resetAccumulator() function to prevent problems due to
 incomplete or incorrect initialization of the AggInfo object. Fix for ticket
 [af4556bb5c285c08].

FossilOrigin-Name: 4a302b42c7bf5e11ddb5522ca999f74aba397d3a7eb91b1844bb02852f772441
Upstream Status: Backport [c415d91007e1680e4eb17def583b202c3c83c718]

CVE: CVE-2020-11655
Signed-off-by: Sakib Sajal <sakib.sajal@windriver.com>
Signed-off-by: Anand Je Sypureddy <anandje@mvista.com>
---
 sqlite3.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/sqlite3.c b/sqlite3.c
index c6dbcc4..1bcf55e 100644
--- a/sqlite3.c
+++ b/sqlite3.c
@@ -133217,6 +133217,7 @@ static void resetAccumulator(Parse *pParse, AggInfo *pAggInfo){
   struct AggInfo_func *pFunc;
   int nReg = pAggInfo->nFunc + pAggInfo->nColumn;
   if( nReg==0 ) return;
+  if( pParse->nErr ) return;
 #ifdef SQLITE_DEBUG
   /* Verify that all AggInfo registers are within the range specified by
   ** AggInfo.mnReg..AggInfo.mxReg */
-- 
2.26.2

