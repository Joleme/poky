From 187e5958a4556d7679bb19991c5a65bc2981162a Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Stefan=20B=C3=BChler?= <stbuehler@web.de>
Date: Fri, 27 Mar 2020 17:17:57 +0100
Subject: [PATCH] dtls client hello: fix zeroed random (fixes #960)
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

This broke with bcf4de03 "handshake: treat reply to HRR as a reply to
hello verify request", which failed to "De Morgan" properly.

Upstream status: backport https://gitlab.com/gnutls/gnutls/-/commit/c01011c2d8533dbbbe754e49e256c109cb848d0d
CVE: CVE-2020-11501

Signed-off-by: Stefan BÃ¼hler <stbuehler@web.de>
Signed-off-by: Rahul Kumar <rahulk@mvista.com>
---
 lib/handshake.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/lib/handshake.c b/lib/handshake.c
index 45bf99a..9933037 100644
--- a/lib/handshake.c
+++ b/lib/handshake.c
@@ -2221,7 +2221,7 @@ static int send_client_hello(gnutls_session_t session, int again)
 		/* Generate random data 
 		 */
 		if (!(session->internals.hsk_flags & HSK_HRR_RECEIVED) &&
-		    !(IS_DTLS(session) && session->internals.dtls.hsk_hello_verify_requests == 0)) {
+		    !(IS_DTLS(session) && session->internals.dtls.hsk_hello_verify_requests != 0)) {
 			ret = _gnutls_gen_client_random(session);
 			if (ret < 0) {
 				gnutls_assert();
