From 9b8d5a2a11b834162f395727c0b79de84557bc07 Mon Sep 17 00:00:00 2001
From: Nick Wellnhofer <wellnhofer@aevum.de>
Date: Sat, 17 Aug 2019 16:51:53 +0200
Subject: [PATCH 2/2] Fix dangling pointer in xsltCopyText

xsltCopyText didn't reset ctxt->lasttext in some cases which could
lead to various memory errors in relation with CDATA sections in input
documents.

Found by OSS-Fuzz.

Upstream status: backport(https://gitlab.gnome.org/GNOME/libxslt/commit/2232473733b7)
CVE: CVE-2019-18197

Signed-off-by: Anand Je Sypureddy <anandje@mvista.com>
---
 libxslt/transform.c | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/libxslt/transform.c b/libxslt/transform.c
index 47f2be1..e0874ba 100644
--- a/libxslt/transform.c
+++ b/libxslt/transform.c
@@ -1091,6 +1091,8 @@ xsltCopyText(xsltTransformContextPtr ctxt, xmlNodePtr target,
 	    if ((copy->content = xmlStrdup(cur->content)) == NULL)
 		return NULL;
 	}
+
+	ctxt->lasttext = NULL;
     } else {
         /*
 	 * normal processing. keep counters to extend the text node
-- 
2.7.4

