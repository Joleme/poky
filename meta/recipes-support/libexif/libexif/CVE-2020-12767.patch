From 68519e835a1dc46e1aa2a39f2ce96533f4fffbe9 Mon Sep 17 00:00:00 2001
From: orangesnn <52818007+orangesnn@users.noreply.github.com>
Date: Mon, 24 Feb 2020 15:16:02 +0800
Subject: [PATCH 2/4] Update the exif-entry.c (#32)

dividing by zero

Upstream Status: Backport https://github.com/libexif/libexif/commit/e22f7306
CVE: CVE-2020-12767

Signed-off-by: Anand Je Sypureddy <anandje@mvista.com>
---
 libexif/exif-entry.c | 7 ++++---
 1 file changed, 4 insertions(+), 3 deletions(-)

diff --git a/libexif/exif-entry.c b/libexif/exif-entry.c
index 54a90a2..f43d70f 100644
--- a/libexif/exif-entry.c
+++ b/libexif/exif-entry.c
@@ -1085,7 +1085,7 @@ exif_entry_get_value (ExifEntry *e, char *val, unsigned int maxlen)
 			break;
 		}
 		d = (double) v_rat.numerator / (double) v_rat.denominator;
-		if (d < 1)
+		if (d < 1 && d)
 			snprintf (val, maxlen, _("1/%i"), (int) (0.5 + 1. / d));
 		else
 			snprintf (val, maxlen, "%i", (int) d);
@@ -1102,8 +1102,9 @@ exif_entry_get_value (ExifEntry *e, char *val, unsigned int maxlen)
 		}
 		d = (double) v_srat.numerator / (double) v_srat.denominator;
 		snprintf (val, maxlen, _("%.02f EV"), d);
-		d = 1. / pow (2, d);
-		if (d < 1)
+		if (pow (2, d))
+			d = 1. / pow (2, d);
+		if (d < 1 && d)
 		  snprintf (b, sizeof (b), _(" (1/%d sec.)"), (int) (1. / d));
 		else
 		  snprintf (b, sizeof (b), _(" (%d sec.)"), (int) d);
-- 
2.27.0

