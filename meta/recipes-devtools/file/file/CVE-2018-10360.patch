From c7b2bbb3899a0dcc68c977cd3c411e2d175bf54c Mon Sep 17 00:00:00 2001
From: Christos Zoulas <christos@zoulas.com>
Date: Sat, 9 Jun 2018 16:00:06 +0000
Subject: [PATCH 3/3] Avoid reading past the end of buffer (Rui Reis)

CVE: CVE-2018-10360
Upstream-Status: Backport
Signed-off-by: Sam Kappen <skappen@mvista.com>
---
 src/readelf.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/src/readelf.c b/src/readelf.c
index 16f1fa52..5f2006c9 100644
--- a/src/readelf.c
+++ b/src/readelf.c
@@ -824,7 +824,8 @@ do_core_note(struct magic_set *ms, unsigned char *nbuf, uint32_t type,
 
 				cname = (unsigned char *)
 				    &nbuf[doff + prpsoffsets(i)];
-				for (cp = cname; *cp && isprint(*cp); cp++)
+				for (cp = cname; cp < nbuf + size && *cp
+				    && isprint(*cp); cp++)
 					continue;
 				/*
 				 * Linux apparently appends a space at the end
-- 
2.13.7

