From 7ce9c224cc371c399930f411e49d207dfec9d5a5 Mon Sep 17 00:00:00 2001
From: George Kennedy <george.kennedy@oracle.com>
Date: Fri, 17 Aug 2018 19:25:48 +0200
Subject: [PATCH 2/5] lsi_scsi: add support for PPR Extended Message

The LSI 53c895a code does not handle the PPR Extended Message. Add
support to handle PPR Extended Message like SDTR and WDTR are handled.
That is, to skip past the message bytes and ignore the message.

Upstream status: backport(https://git.qemu.org/?p=qemu.git;a=patch;h=966a09fac1e8d81738415a9f7e17f8f7cf458288)
CVE: CVE-2019-12068 patch #2

Signed-off-by: George Kennedy <george.kennedy@oracle.com>
Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
Signed-off-by: Anand Je Sypureddy <anandje@mvista.com>
---
 hw/scsi/lsi53c895a.c | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/hw/scsi/lsi53c895a.c b/hw/scsi/lsi53c895a.c
index 9040efc..0c30f0e 100644
--- a/hw/scsi/lsi53c895a.c
+++ b/hw/scsi/lsi53c895a.c
@@ -971,6 +971,10 @@ static void lsi_do_msgout(LSIState *s)
                 DPRINTF("WDTR (ignored)\n");
                 lsi_skip_msgbytes(s, 1);
                 break;
+            case 4:
+                DPRINTF("PPR (ignored)\n");
+                lsi_skip_msgbytes(s, 5);
+                break;
             default:
                 goto bad;
             }
-- 
2.17.1

