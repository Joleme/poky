From 7e56430617fe889e589ad78cd67918166f0f9af4 Mon Sep 17 00:00:00 2001
From: Richard Biener <rguenther@suse.de>
Date: Thu, 25 Jul 2019 10:50:47 +0000
Subject: [PATCH] re PR plugins/90924 (lto-plugin/lto-plugin.c heap memory
 corruption due to insufficient sanitization.)

2019-07-25  Richard Biener  <rguenther@suse.de>

	PR lto/90924
	Backport from mainline
	2019-07-12  Ren Kimura  <rkx1209dev@gmail.com>

	* simple-object-elf.c (simple_object_elf_match): Check zero value
	shstrndx.

From-SVN: r273795

Upstream-Status: Backport https://gcc.gnu.org/git/?p=gcc.git;a=commit;h=7e56430617fe889e589ad78cd67918166f0f9af4

CVE: CVE-2019-14250
Signed-off-by: Armin Kuster <akuster808@gmail.com>

---
 libiberty/ChangeLog           | 9 +++++++++
 libiberty/simple-object-elf.c | 8 ++++++++
 2 files changed, 17 insertions(+)

Index: gcc-7.3.0/libiberty/simple-object-elf.c
===================================================================
--- gcc-7.3.0.orig/libiberty/simple-object-elf.c
+++ gcc-7.3.0/libiberty/simple-object-elf.c
@@ -479,6 +479,14 @@ simple_object_elf_match (unsigned char h
       return NULL;
     }
 
+  if (eor->shstrndx == 0)
+    {
+      *errmsg = "invalid ELF shstrndx == 0";
+      *err = 0;
+      XDELETE (eor);
+      return NULL;
+    }
+
   return (void *) eor;
 }
 
