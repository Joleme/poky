From d0e621268d2feaa0b13ad3d5d4aca5cd677b0a04 Mon Sep 17 00:00:00 2001
From: nagachika <nagachika@b2dd03c8-39d4-4d8f-98ff-823fe69b080e>
Date: Fri, 20 Mar 2020 08:12:05 +0000
Subject: [PATCH] backport 80b5a0ff2a7709367178f29d4ebe1c54122b1c27 partially
 as a securify fix for CVE-2020-10663. The patch was provided by Jeremy Evans.

git-svn-id: svn+ssh://ci.ruby-lang.org/ruby/branches/ruby_2_6@67856 b2dd03c8-39d4-4d8f-98ff-823fe69b080e

omitted changes of version.h as the patch level not same and can't be changed.

Upstream-Status: Backport from [https://github.com/ruby/ruby/commit/36e9ed7]
CVE: CVE-2020-10663
Signed-off-by: Milan Shah <mshah@mvista.com>
---
 ext/json/parser/parser.c  | 2 +-
 ext/json/parser/parser.rl | 2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/ext/json/parser/parser.c b/ext/json/parser/parser.c
index c0a240a..cd7aeb2 100644
--- a/ext/json/parser/parser.c
+++ b/ext/json/parser/parser.c
@@ -1802,7 +1802,7 @@ static VALUE cParser_initialize(int argc, VALUE *argv, VALUE self)
     } else {
         json->max_nesting = 100;
         json->allow_nan = 0;
-        json->create_additions = 1;
+        json->create_additions = 0;
         json->create_id = rb_funcall(mJSON, i_create_id, 0);
         json->object_class = Qnil;
         json->array_class = Qnil;
diff --git a/ext/json/parser/parser.rl b/ext/json/parser/parser.rl
index 9e1341e..4c99643 100644
--- a/ext/json/parser/parser.rl
+++ b/ext/json/parser/parser.rl
@@ -697,7 +697,7 @@ static VALUE cParser_initialize(int argc, VALUE *argv, VALUE self)
     } else {
         json->max_nesting = 100;
         json->allow_nan = 0;
-        json->create_additions = 1;
+        json->create_additions = 0;
         json->create_id = rb_funcall(mJSON, i_create_id, 0);
         json->object_class = Qnil;
         json->array_class = Qnil;
-- 
2.7.4

