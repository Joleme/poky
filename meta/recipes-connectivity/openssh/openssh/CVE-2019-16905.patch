From ab75a25dac1d35d1d9db094fbdf2a94fee8e917f Mon Sep 17 00:00:00 2001
From: kumar shanu <kshanu@mvista.com>
Date: Fri, 13 Dec 2019 14:14:24 +0530
Subject: [PATCH] fix integer overflow in XMSS private key parsing

Upstream-status: Backport
CVE: CVE-2019-16905

Signed-off-by: Kumar Shanu <kshanu@mvista.com>
---
 sshkey-xmss.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/sshkey-xmss.c b/sshkey-xmss.c
index aaae7028..c57681ae 100644
--- a/sshkey-xmss.c
+++ b/sshkey-xmss.c
@@ -977,7 +977,8 @@ sshkey_xmss_decrypt_state(const struct sshkey *k, struct sshbuf *encoded,
 		goto out;
 	}
 	/* check that an appropriate amount of auth data is present */
-	if (sshbuf_len(encoded) < encrypted_len + authlen) {
+	if (sshbuf_len(encoded) < authlen ||
+	    sshbuf_len(encoded) - authlen < encrypted_len) {
 		r = SSH_ERR_INVALID_FORMAT;
 		goto out;
 	}
-- 
2.20.1

