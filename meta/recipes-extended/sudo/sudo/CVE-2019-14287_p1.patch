From 283cdcf08ffebc6490706f3e4579a92545f42f60 Mon Sep 17 00:00:00 2001
From: "Todd C. Miller" <Todd.Miller@sudo.ws>
Date: Thu, 30 Aug 2018 14:06:18 -0600
Subject: [PATCH 1/5] Fix warnings on OpenIndiana (Illumos)

Upstream status: backport(https://github.com/sudo-project/sudo/commit/a924b4610b8e)
CVE: CVE-2019-14287 patch #1

Signed-off-by: Anand Je Sypureddy <anandje@mvista.com>
---
 lib/util/regress/atofoo/atofoo_test.c         | 6 +++---
 lib/util/regress/parse_gids/parse_gids_test.c | 2 +-
 plugins/sudoers/ldap.c                        | 5 +++--
 plugins/sudoers/regress/parser/check_base64.c | 4 ++--
 4 files changed, 9 insertions(+), 8 deletions(-)

diff --git a/lib/util/regress/atofoo/atofoo_test.c b/lib/util/regress/atofoo/atofoo_test.c
index 9b50b1e..0a3199a 100644
--- a/lib/util/regress/atofoo/atofoo_test.c
+++ b/lib/util/regress/atofoo/atofoo_test.c
@@ -83,9 +83,9 @@ static struct strtoid_data {
     { "10", 10, NULL, NULL },
     { "-2", -2, NULL, NULL },
 #if SIZEOF_ID_T != SIZEOF_LONG_LONG
-    { "-2", 4294967294U, NULL, NULL },
+    { "-2", (id_t)4294967294U, NULL, NULL },
 #endif
-    { "4294967294", 4294967294U, NULL, NULL },
+    { "4294967294", (id_t)4294967294U, NULL, NULL },
     { NULL, 0, NULL, NULL }
 };
 
@@ -128,7 +128,7 @@ static struct strtomode_data {
     { "755", 0755 },
     { "007", 007 },
     { "7", 7 },
-    { "8", -1 },
+    { "8", (mode_t)-1 },
     { NULL, 0 }
 };
 
diff --git a/lib/util/regress/parse_gids/parse_gids_test.c b/lib/util/regress/parse_gids/parse_gids_test.c
index 3df23c4..9ff9b2b 100644
--- a/lib/util/regress/parse_gids/parse_gids_test.c
+++ b/lib/util/regress/parse_gids/parse_gids_test.c
@@ -51,7 +51,7 @@ struct parse_gids_test {
 
 static const GETGROUPS_T test1_out[] = { 0, 1, 2, 3, 4 };
 static const GETGROUPS_T test2_out[] = { 1, 2, 3, 4 };
-static const GETGROUPS_T test3_out[] = { 0, 1, -2, 3, 4 };
+static const GETGROUPS_T test3_out[] = { 0, 1, (gid_t)-2, 3, 4 };
 
 /* XXX - test syntax errors too */
 static struct parse_gids_test test_data[] = {
diff --git a/plugins/sudoers/ldap.c b/plugins/sudoers/ldap.c
index 9b866ad..2acf1da 100644
--- a/plugins/sudoers/ldap.c
+++ b/plugins/sudoers/ldap.c
@@ -2682,7 +2682,8 @@ done:
 }
 
 #ifdef HAVE_LDAP_SASL_INTERACTIVE_BIND_S
-static unsigned int (*sudo_gss_krb5_ccache_name)(unsigned int *minor_status, const char *name, const char **old_name);
+typedef unsigned int (*sudo_gss_krb5_ccache_name_t)(unsigned int *minor_status, const char *name, const char **old_name);
+static sudo_gss_krb5_ccache_name_t sudo_gss_krb5_ccache_name;
 
 static int
 sudo_set_krb5_ccache_name(const char *name, const char **old_name)
@@ -2693,7 +2694,7 @@ sudo_set_krb5_ccache_name(const char *name, const char **old_name)
     debug_decl(sudo_set_krb5_ccache_name, SUDOERS_DEBUG_LDAP)
 
     if (!initialized) {
-	sudo_gss_krb5_ccache_name =
+	sudo_gss_krb5_ccache_name = (sudo_gss_krb5_ccache_name_t)
 	    sudo_dso_findsym(SUDO_DSO_DEFAULT, "gss_krb5_ccache_name");
 	initialized = true;
     }
diff --git a/plugins/sudoers/regress/parser/check_base64.c b/plugins/sudoers/regress/parser/check_base64.c
index 7af85bb..44843c9 100644
--- a/plugins/sudoers/regress/parser/check_base64.c
+++ b/plugins/sudoers/regress/parser/check_base64.c
@@ -39,14 +39,14 @@ extern size_t base64_decode(const char *str, unsigned char *dst, size_t dsize);
 
 __dso_public int main(int argc, char *argv[]);
 
-static char bstring1[] = { 0xea, 0xb8, 0xa2, 0x71, 0xef, 0x67, 0xc1, 0xcd, 0x0d, 0xd9, 0xa6, 0xaa, 0xa8, 0x24, 0x77, 0x2a, 0xfc, 0x6f, 0x76, 0x37, 0x1b, 0xed, 0x9e, 0x1a, 0x90, 0x5f, 0xcf, 0xbc, 0x00 };
+static unsigned char bstring1[] = { 0xea, 0xb8, 0xa2, 0x71, 0xef, 0x67, 0xc1, 0xcd, 0x0d, 0xd9, 0xa6, 0xaa, 0xa8, 0x24, 0x77, 0x2a, 0xfc, 0x6f, 0x76, 0x37, 0x1b, 0xed, 0x9e, 0x1a, 0x90, 0x5f, 0xcf, 0xbc, 0x00 };
 
 struct base64_test {
     const char *ascii;
     const char *encoded;
 } test_strings[] = {
     {
-	bstring1,
+	(char *)bstring1,
 	"6riice9nwc0N2aaqqCR3Kvxvdjcb7Z4akF/PvA=="
     },
     {
-- 
2.7.4

