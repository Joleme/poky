From 73a390c8734b81d72675c66e8c9bbaf1138a2e39 Mon Sep 17 00:00:00 2001
From: Sergey Poznyakoff <gray@gnu.org>
Date: Mon, 14 Jan 2019 15:22:09 +0200
Subject: [PATCH] Fix possible NULL dereference (savannah bug #55369)

* src/sparse.c (pax_decode_header): Check return from find_next_block.

Upstream-Status: Backport (http://git.savannah.gnu.org/cgit/tar.git/commit/?id=cb07844454d8cc9fb21f53ace75975f91185a120)
CVE: CVE-2019-9923

Signed-off-by: Rahul Chauhan <rahulk@mvista.com>
---
 src/sparse.c | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/src/sparse.c b/src/sparse.c
index 58219f2..f06030b 100644
--- a/src/sparse.c
+++ b/src/sparse.c
@@ -1265,6 +1265,8 @@ pax_decode_header (struct tar_sparse_file *file)
	 {                                                         \
	   set_next_block_after (b);                               \
            b = find_next_block ();                                 \
+           if (!b)                                                 \
+             FATAL_ERROR ((0, 0, _("Unexpected EOF in archive"))); \
            src = b->buffer;                                        \
	   endp = b->buffer + BLOCKSIZE;                           \
	 }                                                         \
@@ -1277,6 +1279,8 @@ pax_decode_header (struct tar_sparse_file *file)
       start = current_block_ordinal ();
       set_next_block_after (current_header);
       blk = find_next_block ();
+      if (!blk)
+        FATAL_ERROR ((0, 0, _("Unexpected EOF in archive")));
       p = blk->buffer;
       COPY_BUF (blk,nbuf,p);
       if (!decode_num (&u, nbuf, TYPE_MAXIMUM (size_t)))
--
2.7.4
