From fcd1bb93124d76059abef98216d8390f520c577b Mon Sep 17 00:00:00 2001
From: Glenn Randers-Pehrson <glennrp at users.sourceforge.net>
Date: Sat, 5 Aug 2017 15:08:40 -0500
Subject: [PATCH] [libpng16] Removed unused chunk_name parameter from
 png_check_chunk_length().

Upstream-Status: Backport (patch #7)
CVE: CVE-2017-12652
Signed-off-by: Sunil Kumar <sukumar@mvista.com>
---
 pngpread.c | 3 +--
 pngpriv.h  | 2 +-
 pngrutil.c | 5 ++---
 3 files changed, 4 insertions(+), 6 deletions(-)

diff --git a/pngpread.c b/pngpread.c
index b1f242c..b2d7d3b 100644
--- a/pngpread.c
+++ b/pngpread.c
@@ -190,8 +190,7 @@ png_push_read_chunk(png_structrp png_ptr, png_inforp info_ptr)
       png_crc_read(png_ptr, chunk_tag, 4);
       png_ptr->chunk_name = PNG_CHUNK_FROM_STRING(chunk_tag);
       png_check_chunk_name(png_ptr, png_ptr->chunk_name);
-      png_check_chunk_length(png_ptr, png_ptr->chunk_name,
-          png_ptr->push_length);
+      png_check_chunk_length(png_ptr, png_ptr->push_length);
       png_ptr->mode |= PNG_HAVE_CHUNK_HEADER;
    }
 
diff --git a/pngpriv.h b/pngpriv.h
index 903b6bd..c301e56 100644
--- a/pngpriv.h
+++ b/pngpriv.h
@@ -1526,7 +1526,7 @@ PNG_INTERNAL_FUNCTION(void,png_check_chunk_name,(png_structrp png_ptr,
     png_uint_32 chunk_name),PNG_EMPTY);
 
 PNG_INTERNAL_FUNCTION(void,png_check_chunk_length,(png_structrp png_ptr,
-    png_uint_32 chunk_name, png_uint_32 chunk_length),PNG_EMPTY);
+    png_uint_32 chunk_length),PNG_EMPTY);
 
 PNG_INTERNAL_FUNCTION(void,png_handle_unknown,(png_structrp png_ptr,
     png_inforp info_ptr, png_uint_32 length, int keep),PNG_EMPTY);
diff --git a/pngrutil.c b/pngrutil.c
index 4722508..510bbf7 100644
--- a/pngrutil.c
+++ b/pngrutil.c
@@ -182,7 +182,7 @@ png_read_chunk_header(png_structrp png_ptr)
    png_check_chunk_name(png_ptr, png_ptr->chunk_name);
 
    /* Check for too-large chunk length */
-   png_check_chunk_length(png_ptr, png_ptr->chunk_name, length);
+   png_check_chunk_length(png_ptr, length);
 
 #ifdef PNG_IO_STATE_SUPPORTED
    png_ptr->io_state = PNG_IO_READING | PNG_IO_CHUNK_DATA;
@@ -3097,8 +3097,7 @@ png_check_chunk_name(png_structrp png_ptr, png_uint_32 chunk_name)
 }
 
 void /* PRIVATE */
-png_check_chunk_length(png_structrp png_ptr, png_uint_32 chunk_name,
-   png_uint_32 length)
+png_check_chunk_length(png_structrp png_ptr, png_uint_32 length)
 {
    png_alloc_size_t limit = PNG_UINT_31_MAX;
 
-- 
2.7.4

