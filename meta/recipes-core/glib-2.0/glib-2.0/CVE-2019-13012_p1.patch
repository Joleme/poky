From 8bf0fbe9d96f5fb44703343c3a93c2d781862a79 Mon Sep 17 00:00:00 2001
From: Markus Koschany <apo@debian.org>
Date: Wed, 3 Jul 2019 14:41:18 +0200
Subject: [PATCH 1/2] CVE-2019-13012

Bug-Debian: https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=931234
Bug-Upstream: https://gitlab.gnome.org/GNOME/glib/issues/1658
Origin: https://gitlab.gnome.org/GNOME/glib/commit/5e4da714f00f6bfb2ccd6d73d61329c6f3a08429

Upstream-Status: Backport
CVE: CVE-2019-13012
Signed-off-by: Milan Shah <mshah@mvista.com>
---
 gio/gkeyfilesettingsbackend.c | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/gio/gkeyfilesettingsbackend.c b/gio/gkeyfilesettingsbackend.c
index 9375955..fa62f58 100644
--- a/gio/gkeyfilesettingsbackend.c
+++ b/gio/gkeyfilesettingsbackend.c
@@ -627,6 +627,7 @@ g_keyfile_settings_backend_new (const gchar *filename,
                                 const gchar *root_group)
 {
   GKeyfileSettingsBackend *kfsb;
+  char *dir;
 
   g_return_val_if_fail (filename != NULL, NULL);
   g_return_val_if_fail (root_path != NULL, NULL);
@@ -640,7 +641,9 @@ g_keyfile_settings_backend_new (const gchar *filename,
 
   kfsb->file = g_file_new_for_path (filename);
   kfsb->dir = g_file_get_parent (kfsb->file);
-  g_file_make_directory_with_parents (kfsb->dir, NULL, NULL);
+  dir = g_file_get_path (kfsb->dir);
+  g_mkdir_with_parents (dir, 0700);
+  g_free (dir);
 
   kfsb->file_monitor = g_file_monitor (kfsb->file, 0, NULL, NULL);
   kfsb->dir_monitor = g_file_monitor (kfsb->dir, 0, NULL, NULL);
-- 
2.7.4

