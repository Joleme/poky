From b6ab8b449cf47e5992d803fc588fe7e621f4526d Mon Sep 17 00:00:00 2001
From: Nick Wellnhofer <wellnhofer@aevum.de>
Date: Sun, 19 Aug 2018 18:59:10 +0200
Subject: [PATCH] Improve error message if pkg.m4 couldn't be found
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Check whether aclocal.m4 contains the pkg.m4 macro package after running
autoreconf and print a more helpful error message.

Thanks to 林博仁 (Buo-ren Lin) for the initial patch.

Closes: #21

CVE: CVE-2017-18258
Upstream-Status: Backport from https://gitlab.gnome.org/GNOME/libxml2/commit/e2a9122b8dde53d320750451e9907a7dcb2ca8bb

Signed-off-by: Jagadeesh Krishnanjanappa <jkrishnanjanappa@mvista.com>
---
 autogen.sh | 9 +++++++++
 1 file changed, 9 insertions(+)

diff --git a/autogen.sh b/autogen.sh
index 4e7858a5..d9c49f4c 100755
--- a/autogen.sh
+++ b/autogen.sh
@@ -69,6 +69,15 @@ autoreconf -if -Wall
 
 cd $THEDIR
 
+if ! grep -q pkg.m4 aclocal.m4; then
+    cat <<EOF
+
+Couldn't find pkg.m4 from pkg-config. Install the appropriate package for
+your distribution or set ACLOCAL_PATH to the directory containing pkg.m4.
+EOF
+    exit 1
+fi
+
 if test x$OBJ_DIR != x; then
     mkdir -p "$OBJ_DIR"
     cd "$OBJ_DIR"
-- 
2.13.3

