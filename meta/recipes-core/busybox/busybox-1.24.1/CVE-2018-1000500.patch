From 0972c7f7a570c38edb68e1c60a45614b7a7c7d55 Mon Sep 17 00:00:00 2001
From: Denys Vlasenko <vda.linux@googlemail.com>
Date: Mon, 28 May 2018 14:36:26 +0200
Subject: [PATCH] wget: emit a message that certificate verification is not
 implemented

function                                             old     new   delta
spawn_ssl_client                                     185     209     +24

Signed-off-by: Denys Vlasenko <vda.linux@googlemail.com>

Upstream-Status: Backport
CVE: CVE-2018-1000500
Signed-off-by: Armin Kuster <akuster@mvista.com>

---
 networking/wget.c | 9 +++++++--
 1 file changed, 7 insertions(+), 2 deletions(-)

Index: busybox-1.24.1/networking/wget.c
===================================================================
--- busybox-1.24.1.orig/networking/wget.c
+++ busybox-1.24.1/networking/wget.c
@@ -236,6 +236,7 @@ enum {
 	WGET_OPT_PASSIVE    = (1 << 9),
 	WGET_OPT_HEADER     = (1 << 10) * ENABLE_FEATURE_WGET_LONG_OPTIONS,
 	WGET_OPT_POST_DATA  = (1 << 11) * ENABLE_FEATURE_WGET_LONG_OPTIONS,
+        WGET_OPT_NO_CHECK_CERT = (1 << 13) * ENABLE_FEATURE_WGET_LONG_OPTIONS,
 };
 
 enum {
@@ -616,6 +617,9 @@ static int spawn_https_helper_openssl(co
 	int pid;
 	IF_FEATURE_WGET_SSL_HELPER(volatile int child_failed = 0;)
 
+	if (!(option_mask32 & WGET_OPT_NO_CHECK_CERT))
+		bb_error_msg("note: TLS certificate validation not implemented");
+
 	if (socketpair(AF_UNIX, SOCK_STREAM, 0, sp) != 0)
 		/* Kernel can have AF_UNIX support disabled */
 		bb_perror_msg_and_die("socketpair");
@@ -1218,6 +1222,7 @@ int wget_main(int argc UNUSED_PARAM, cha
 		"continue\0"         No_argument       "c"
 //FIXME: -s isn't --spider, it's --save-headers!
 		"spider\0"           No_argument       "s"
+                "no-check-certificate\0" No_argument "\xfc"
 		"quiet\0"            No_argument       "q"
 		"output-document\0"  Required_argument "O"
 		"directory-prefix\0" Required_argument "P"
