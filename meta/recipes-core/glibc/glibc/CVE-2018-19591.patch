From fb0a0c5fb652690c50ce6f3c15229240df17ccea Mon Sep 17 00:00:00 2001
From: Florian Weimer <fweimer@redhat.com> 
Date: Tue, 27 Nov 2018 16:05:16 +0100 
Subject: [PATCH] CVE-2018-19591: if_nametoindex: Fix descriptor for overlong
 name

We need to check the length of the string right before the strncpy call
to avoid reintroducing the compiler warning from bug 22442.

2018-11-27  Florian Weimer  <fweimer@redhat.com>

	[BZ #23927]
	CVE-2018-19591
	* sysdeps/unix/sysv/linux/if_index.c (__if_nametoindex): Close
	descriptor in case of ENODEV error.

https://sourceware.org/ml/libc-alpha/2018-11/msg00698.html
Upstream-status: backport

---
 sysdeps/unix/sysv/linux/if_index.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/sysdeps/unix/sysv/linux/if_index.c b/sysdeps/unix/sysv/linux/if_index.c
index a874634d52..fc429dac19 100644
--- a/sysdeps/unix/sysv/linux/if_index.c
+++ b/sysdeps/unix/sysv/linux/if_index.c
@@ -45,6 +45,7 @@ __if_nametoindex (const char *ifname)
 
   if (strlen (ifname) >= IFNAMSIZ)
     {
+      close_not_cancel_no_status (fd);
       __set_errno (ENODEV);
       return 0;
     }
-- 
2.13.3

